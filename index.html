<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ú¯ÙØªÚ¯ÙˆÙ‡Ø§ÛŒ Ù…Ù† Ø¨Ø§ Ø®ÙˆØ¯ </title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="styles.css">

</head>

<body>
    <header>
        <h1>ğŸ“ Ù…Ø§Ù†ÛŒÙØ³Øª Ø´Ø®ØµÛŒ</h1>
    </header>

    <!-- Ú¯Ø±ÛŒØ¯ Ù¾Ø³Øªâ€ŒÙ‡Ø§ -->
    <div id="posts-grid">
        <div class="loading">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾Ø³Øªâ€ŒÙ‡Ø§...</div>
    </div>

    <!-- Ù†Ù…Ø§ÛŒØ´ Ù¾Ø³Øª -->
    <div id="post-view">
        <button class="back-btn" onclick="goBack()">â†’ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù„ÛŒØ³Øª</button>
        <div id="post-content"></div>
    </div>

    <script>
        // âš ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª - Ø§ÛŒÙ†Ø¬Ø§ Ø±Ø§ ØªØºÛŒÛŒØ± Ø¯Ù‡ÛŒØ¯
        const CONFIG = {
            username: 'arazshah',  // Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ú¯ÛŒØªâ€ŒÙ‡Ø§Ø¨
            repo: 'self',            // Ù†Ø§Ù… Ø±ÛŒÙ¾Ø§Ø²ÛŒØªÙˆØ±ÛŒ
            branch: 'master',                     // Ø´Ø§Ø®Ù‡ (main ÛŒØ§ master)
            postsFolder: 'posts'               // Ù¾ÙˆØ´Ù‡ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ md (ÛŒØ§ '' Ø¨Ø±Ø§ÛŒ Ø±ÛŒØ´Ù‡)
        };

        const postsGrid = document.getElementById('posts-grid');
        const postView = document.getElementById('post-view');
        const postContent = document.getElementById('post-content');

        // Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ MD
        async function loadPosts() {
            try {
                const path = CONFIG.postsFolder ? `/${CONFIG.postsFolder}` : '';
                const apiUrl = `https://api.github.com/repos/${CONFIG.username}/${CONFIG.repo}/contents${path}?ref=${CONFIG.branch}`;

                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§');

                const files = await response.json();
                const mdFiles = files.filter(f => f.name.endsWith('.md'));

                if (mdFiles.length === 0) {
                    postsGrid.innerHTML = '<div class="error">Ù‡ÛŒÚ† ÙØ§ÛŒÙ„ MD ÛŒØ§ÙØª Ù†Ø´Ø¯</div>';
                    return;
                }

                const posts = mdFiles.slice(0, 32);

                // Ø³Ø§Ø®Øª URL Ø¨Ø±Ø§ÛŒ thumbnail
                const rawBase = `https://raw.githubusercontent.com/${CONFIG.username}/${CONFIG.repo}/${CONFIG.branch}/${CONFIG.postsFolder}/img`;

                postsGrid.innerHTML = posts.map(file => {
                    const baseName = file.name.replace('.md', '');
                    const imageFile = files.find(f =>
                        f.name.startsWith(baseName) &&
                        /\.(jpg|jpeg|png|webp|gif)$/i.test(f.name)
                    );
                    const thumbUrl = imageFile
                        ? imageFile.download_url
                        : 'https://via.placeholder.com/300x150?text=No+Image';

                    return `
                <div class="post-card" onclick="loadPost('${file.download_url}', '${file.name}')">
                    <div class="post-thumb">
                        <img src="${thumbUrl}" alt="${baseName}" onerror="this.src='https://via.placeholder.com/300x150?text=No+Image'">
                    </div>
                    <h3>${formatTitle(file.name)}</h3>
                    <p>Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù…Ø·Ø§Ù„Ø¹Ù‡...</p>
                </div>
            `;
                }).join('');

            } catch (error) {
                postsGrid.innerHTML = `<div class="error">Ø®Ø·Ø§: ${error.message}</div>`;
            }
        }

        // ØªØ¨Ø¯ÛŒÙ„ Ù†Ø§Ù… ÙØ§ÛŒÙ„ Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Ø®ÙˆØ§Ù†Ø§
        function formatTitle(filename) {
            return filename
                .replace('.md', '')
                .replace(/-/g, ' ')
                .replace(/_/g, ' ');
        }

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ùˆ Ù†Ù…Ø§ÛŒØ´ ÛŒÚ© Ù¾Ø³Øª
        async function loadPost(url, filename) {
            postContent.innerHTML = '<div class="loading">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>';
            postsGrid.classList.add('hidden');
            postView.classList.add('active');

            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù…Ø­ØªÙˆØ§');

                const markdown = await response.text();
                postContent.innerHTML = marked.parse(markdown);

            } catch (error) {
                postContent.innerHTML = `<div class="error">Ø®Ø·Ø§: ${error.message}</div>`;
            }
        }

        // Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù„ÛŒØ³Øª
        function goBack() {
            postView.classList.remove('active');
            postsGrid.classList.remove('hidden');
        }

        // Ø´Ø±ÙˆØ¹
        loadPosts();
    </script>
</body>

</html>